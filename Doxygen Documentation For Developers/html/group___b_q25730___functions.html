<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: BQ25730 Battery Charger Functions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('group___b_q25730___functions.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">BQ25730 Battery Charger Functions </div></div>
</div><!--header-->
<div class="contents">

<p>Functions for controlling and monitoring BQ25730 battery charger.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gafd859bfac909576582c08cfd3aef4543" id="r_gafd859bfac909576582c08cfd3aef4543"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gafd859bfac909576582c08cfd3aef4543">CheckBQConnectionWithComms</a> ()</td></tr>
<tr class="memdesc:gafd859bfac909576582c08cfd3aef4543"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check BQ25730 connection and halt system if not responding.  <br /></td></tr>
<tr class="memitem:ga68faf4969b4fd59b23916844263fa728" id="r_ga68faf4969b4fd59b23916844263fa728"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga68faf4969b4fd59b23916844263fa728">ConfigAndStartBQ</a> ()</td></tr>
<tr class="memdesc:ga68faf4969b4fd59b23916844263fa728"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configure and start BQ25730 charger with initial settings.  <br /></td></tr>
<tr class="memitem:gaf6496b205c191db45c1b03fdc69b37b8" id="r_gaf6496b205c191db45c1b03fdc69b37b8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gaf6496b205c191db45c1b03fdc69b37b8">writeBQ25730</a> (uint8_t regAddr, uint16_t data)</td></tr>
<tr class="memdesc:gaf6496b205c191db45c1b03fdc69b37b8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write 16-bit data to BQ25730 register.  <br /></td></tr>
<tr class="memitem:ga2c4dd77d242508e96fb3513e753976f7" id="r_ga2c4dd77d242508e96fb3513e753976f7"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga2c4dd77d242508e96fb3513e753976f7">readBQ25730</a> (uint8_t regAddr)</td></tr>
<tr class="memdesc:ga2c4dd77d242508e96fb3513e753976f7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read 16-bit data from BQ25730 register.  <br /></td></tr>
<tr class="memitem:ga1de5db1b0b55008babf30a501b39b6b7" id="r_ga1de5db1b0b55008babf30a501b39b6b7"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga1de5db1b0b55008babf30a501b39b6b7">checkI2C</a> ()</td></tr>
<tr class="memdesc:ga1de5db1b0b55008babf30a501b39b6b7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check I2C communication with BQ25730.  <br /></td></tr>
<tr class="memitem:gafc599b42d2e7ceba7c94028dfcd99125" id="r_gafc599b42d2e7ceba7c94028dfcd99125"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gafc599b42d2e7ceba7c94028dfcd99125">checkBQConnection</a> ()</td></tr>
<tr class="memdesc:gafc599b42d2e7ceba7c94028dfcd99125"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check basic I2C connection to BQ25730.  <br /></td></tr>
<tr class="memitem:ga2d4bd64f668a6ea0b2f5a8424d9a1100" id="r_ga2d4bd64f668a6ea0b2f5a8424d9a1100"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga2d4bd64f668a6ea0b2f5a8424d9a1100">disableVSYS</a> ()</td></tr>
<tr class="memdesc:ga2d4bd64f668a6ea0b2f5a8424d9a1100"><td class="mdescLeft">&#160;</td><td class="mdescRight">Disable VSYS output due to low battery condition.  <br /></td></tr>
<tr class="memitem:ga01cd5968ed55b80dc4b92b0a52e0e466" id="r_ga01cd5968ed55b80dc4b92b0a52e0e466"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga01cd5968ed55b80dc4b92b0a52e0e466">setChargeVoltage</a> (float voltage_V)</td></tr>
<tr class="memdesc:ga01cd5968ed55b80dc4b92b0a52e0e466"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set charging voltage target.  <br /></td></tr>
<tr class="memitem:ga97c42fd6e90822b907550eb226598161" id="r_ga97c42fd6e90822b907550eb226598161"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga97c42fd6e90822b907550eb226598161">setChargeCurrent</a> (float current_A)</td></tr>
<tr class="memdesc:ga97c42fd6e90822b907550eb226598161"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set charging current limit.  <br /></td></tr>
<tr class="memitem:ga3d8eff3631e2364d8be2890e9baabe63" id="r_ga3d8eff3631e2364d8be2890e9baabe63"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga3d8eff3631e2364d8be2890e9baabe63">setInputCurrentLimit</a> (float current_mA)</td></tr>
<tr class="memdesc:ga3d8eff3631e2364d8be2890e9baabe63"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set input current limit.  <br /></td></tr>
<tr class="memitem:ga418209c95fe881aa56d9e82ac1b4ad63" id="r_ga418209c95fe881aa56d9e82ac1b4ad63"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga418209c95fe881aa56d9e82ac1b4ad63">setInputVoltage</a> (float voltage_V)</td></tr>
<tr class="memdesc:ga418209c95fe881aa56d9e82ac1b4ad63"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the input voltage limit for the BQ25730 charge controller.  <br /></td></tr>
<tr class="memitem:gacb449db001d5ad9a7758556e5ca2160a" id="r_gacb449db001d5ad9a7758556e5ca2160a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gacb449db001d5ad9a7758556e5ca2160a">set_VSYS_MIN</a> (float voltage_V)</td></tr>
<tr class="memdesc:gacb449db001d5ad9a7758556e5ca2160a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the minimum system voltage (VSYS_MIN) for the BQ25730.  <br /></td></tr>
<tr class="memitem:gab30ea562af302301b7672b24f4481c86" id="r_gab30ea562af302301b7672b24f4481c86"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gab30ea562af302301b7672b24f4481c86">enableCharging</a> ()</td></tr>
<tr class="memdesc:gab30ea562af302301b7672b24f4481c86"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enables charging by configuring ChargeOption0 register.  <br /></td></tr>
<tr class="memitem:gae0f230a6e9357f99995951287147b6ee" id="r_gae0f230a6e9357f99995951287147b6ee"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gae0f230a6e9357f99995951287147b6ee">disableCharging</a> ()</td></tr>
<tr class="memdesc:gae0f230a6e9357f99995951287147b6ee"><td class="mdescLeft">&#160;</td><td class="mdescRight">Disables charging by setting charge inhibit bit.  <br /></td></tr>
<tr class="memitem:ga5eddb9004f705b0881f16a636b2d83cf" id="r_ga5eddb9004f705b0881f16a636b2d83cf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga5eddb9004f705b0881f16a636b2d83cf">enableADC</a> ()</td></tr>
<tr class="memdesc:ga5eddb9004f705b0881f16a636b2d83cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enables ADC measurements on the BQ25730.  <br /></td></tr>
<tr class="memitem:gaab5e0e511f1bb8041569b20b1489527b" id="r_gaab5e0e511f1bb8041569b20b1489527b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gaab5e0e511f1bb8041569b20b1489527b">readBatteryCurrent</a> ()</td></tr>
<tr class="memdesc:gaab5e0e511f1bb8041569b20b1489527b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads and displays battery current measurements.  <br /></td></tr>
<tr class="memitem:ga4984336d1011808120b4221bbd3c48af" id="r_ga4984336d1011808120b4221bbd3c48af"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga4984336d1011808120b4221bbd3c48af">dumpAllBQRegisters</a> ()</td></tr>
<tr class="memdesc:ga4984336d1011808120b4221bbd3c48af"><td class="mdescLeft">&#160;</td><td class="mdescRight">Dumps all BQ25730 registers for debugging.  <br /></td></tr>
<tr class="memitem:ga0882365eaa2c963c6b0b2e57237c6b90" id="r_ga0882365eaa2c963c6b0b2e57237c6b90"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga0882365eaa2c963c6b0b2e57237c6b90">MaintainChargingBQ</a> ()</td></tr>
<tr class="memdesc:ga0882365eaa2c963c6b0b2e57237c6b90"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maintains charging operation and I2C communication.  <br /></td></tr>
<tr class="memitem:gabf363a8269099400e262e0c39becc8a0" id="r_gabf363a8269099400e262e0c39becc8a0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gabf363a8269099400e262e0c39becc8a0">CheckIfINAConnected</a> ()</td></tr>
<tr class="memdesc:gabf363a8269099400e262e0c39becc8a0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes and verifies INA219 current sensors.  <br /></td></tr>
<tr class="memitem:ga5ef907155a3498383307a0e26da4e010" id="r_ga5ef907155a3498383307a0e26da4e010"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga5ef907155a3498383307a0e26da4e010">EnableGPIOPins</a> ()</td></tr>
<tr class="memdesc:ga5ef907155a3498383307a0e26da4e010"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configures GPIO pins for various system functions.  <br /></td></tr>
<tr class="memitem:gab7d6082d420719c5e210b8b387cda184" id="r_gab7d6082d420719c5e210b8b387cda184"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gab7d6082d420719c5e210b8b387cda184">checkCellandSocCutoff</a> ()</td></tr>
<tr class="memdesc:gab7d6082d420719c5e210b8b387cda184"><td class="mdescLeft">&#160;</td><td class="mdescRight">Monitors cell voltages and state of charge for safety cutoffs.  <br /></td></tr>
<tr class="memitem:gac7f04b5f3622adc4c899012ea1d8e6e3" id="r_gac7f04b5f3622adc4c899012ea1d8e6e3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gac7f04b5f3622adc4c899012ea1d8e6e3">ChargeAndBalanceControl</a> ()</td></tr>
<tr class="memdesc:gac7f04b5f3622adc4c899012ea1d8e6e3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main charge and cell balancing control function.  <br /></td></tr>
<tr class="memitem:gae1455fa902ab93ac72aa2c75cc301799" id="r_gae1455fa902ab93ac72aa2c75cc301799"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gae1455fa902ab93ac72aa2c75cc301799">handleSerialCharging</a> ()</td></tr>
<tr class="memdesc:gae1455fa902ab93ac72aa2c75cc301799"><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes serial commands for manual charge control.  <br /></td></tr>
<tr class="memitem:gad511a9c47838109c758c7c4284d2b242" id="r_gad511a9c47838109c758c7c4284d2b242"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gad511a9c47838109c758c7c4284d2b242">TempCheck</a> ()</td></tr>
<tr class="memdesc:gad511a9c47838109c758c7c4284d2b242"><td class="mdescLeft">&#160;</td><td class="mdescRight">Monitors thermistor temperatures for overheat protection.  <br /></td></tr>
<tr class="memitem:ga5708add1ce23a932ff6c9f64cb84ae06" id="r_ga5708add1ce23a932ff6c9f64cb84ae06"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga5708add1ce23a932ff6c9f64cb84ae06">ConfigCheck</a> ()</td></tr>
<tr class="memdesc:ga5708add1ce23a932ff6c9f64cb84ae06"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs final configuration check and saves settings to EEPROM.  <br /></td></tr>
<tr class="memitem:ga3e21dc6b2d0de8c60db0cf01b0625b4c" id="r_ga3e21dc6b2d0de8c60db0cf01b0625b4c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga3e21dc6b2d0de8c60db0cf01b0625b4c">onReceive</a> (int howMany)</td></tr>
<tr class="memdesc:ga3e21dc6b2d0de8c60db0cf01b0625b4c"><td class="mdescLeft">&#160;</td><td class="mdescRight">I2C receive event handler for command processing.  <br /></td></tr>
<tr class="memitem:gac6532b6359ec1083f0936a3a1c93bdce" id="r_gac6532b6359ec1083f0936a3a1c93bdce"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gac6532b6359ec1083f0936a3a1c93bdce">onRequest</a> ()</td></tr>
<tr class="memdesc:gac6532b6359ec1083f0936a3a1c93bdce"><td class="mdescLeft">&#160;</td><td class="mdescRight">I2C request event handler for sending response data.  <br /></td></tr>
<tr class="memitem:ga3a0c6d2d9f8bac7b4f689eb7844c165d" id="r_ga3a0c6d2d9f8bac7b4f689eb7844c165d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga3a0c6d2d9f8bac7b4f689eb7844c165d">EEPROM_Check</a> ()</td></tr>
<tr class="memdesc:ga3a0c6d2d9f8bac7b4f689eb7844c165d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks and loads configuration from EEPROM if available.  <br /></td></tr>
<tr class="memitem:gac732a8f96986a17c049865fa413935b5" id="r_gac732a8f96986a17c049865fa413935b5"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gac732a8f96986a17c049865fa413935b5">isEEPROMInitialized</a> (int startAddr, size_t length)</td></tr>
<tr class="memdesc:gac732a8f96986a17c049865fa413935b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks if EEPROM contains valid (non-blank) data.  <br /></td></tr>
<tr class="memitem:gad56b6e6d2810d8f19d6debf12443fdfd" id="r_gad56b6e6d2810d8f19d6debf12443fdfd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gad56b6e6d2810d8f19d6debf12443fdfd">clearEEPROM</a> ()</td></tr>
<tr class="memdesc:gad56b6e6d2810d8f19d6debf12443fdfd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clears all EEPROM data by setting all bytes to 0xFF.  <br /></td></tr>
<tr class="memitem:ga4fc01d736fe50cf5b977f755b675f11d" id="r_ga4fc01d736fe50cf5b977f755b675f11d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga4fc01d736fe50cf5b977f755b675f11d">setup</a> ()</td></tr>
<tr class="memdesc:ga4fc01d736fe50cf5b977f755b675f11d"><td class="mdescLeft">&#160;</td><td class="mdescRight">System initialization and setup function.  <br /></td></tr>
<tr class="memitem:ga47d79ee7b65523eac216088cb98bbfbb" id="r_ga47d79ee7b65523eac216088cb98bbfbb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga47d79ee7b65523eac216088cb98bbfbb">SystemCheck</a> ()</td></tr>
<tr class="memdesc:ga47d79ee7b65523eac216088cb98bbfbb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main system monitoring and control function (Timer ISR)  <br /></td></tr>
<tr class="memitem:gafe461d27b9c48d5921c00d521181f12f" id="r_gafe461d27b9c48d5921c00d521181f12f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gafe461d27b9c48d5921c00d521181f12f">loop</a> ()</td></tr>
<tr class="memdesc:gafe461d27b9c48d5921c00d521181f12f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main program loop (intentionally empty)  <br /></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<p>Functions for controlling and monitoring BQ25730 battery charger. </p>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="gac7f04b5f3622adc4c899012ea1d8e6e3" name="gac7f04b5f3622adc4c899012ea1d8e6e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac7f04b5f3622adc4c899012ea1d8e6e3">&#9670;&#160;</a></span>ChargeAndBalanceControl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ChargeAndBalanceControl </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main charge and cell balancing control function. </p>
<p>This comprehensive function manages the entire charging process:</p><ul>
<li>Checks charge enable/disable conditions based on plugin status</li>
<li>Reads all cell voltages using INA219 sensors and LTC2943</li>
<li>Performs safety checks via <a class="el" href="#gab7d6082d420719c5e210b8b387cda184" title="Monitors cell voltages and state of charge for safety cutoffs.">checkCellandSocCutoff()</a></li>
<li>Controls individual cell balancing circuits during charging</li>
<li>Updates and displays all system measurements</li>
</ul>
<p>The cell balancing logic activates bypass resistors for any cell that exceeds the CellFullChargeV threshold during charging.</p>
<dl class="section note"><dt>Note</dt><dd>Cell voltages calculated as differential measurements between INA sensors </dd>
<dd>
CELL1 = Pack_Voltage - INA_0x44, CELL2 = INA_0x44 - INA_0x41, etc. </dd></dl>
<dl class="section post"><dt>Postcondition</dt><dd>Updates global variables for all measurements and charging state </dd>
<dd>
Prints comprehensive status information to Serial </dd></dl>

</div>
</div>
<a id="gafc599b42d2e7ceba7c94028dfcd99125" name="gafc599b42d2e7ceba7c94028dfcd99125"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gafc599b42d2e7ceba7c94028dfcd99125">&#9670;&#160;</a></span>checkBQConnection()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool checkBQConnection </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check basic I2C connection to BQ25730. </p>
<dl class="section return"><dt>Returns</dt><dd>true if I2C transmission successful, false otherwise </dd></dl>
<p>&lt; Start I2C transmission to BQ25730</p>
<p>&lt; Return true if transmission successful (no error)</p>

</div>
</div>
<a id="gafd859bfac909576582c08cfd3aef4543" name="gafd859bfac909576582c08cfd3aef4543"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gafd859bfac909576582c08cfd3aef4543">&#9670;&#160;</a></span>CheckBQConnectionWithComms()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CheckBQConnectionWithComms </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check BQ25730 connection and halt system if not responding. </p>
<p>Verifies I2C communication with BQ25730 and stops execution if failed </p>
<p>&lt; Test I2C connection to BQ25730</p>
<p>&lt; Print error message</p>
<p>&lt; Halt system execution indefinitely</p>
<p>&lt; Confirm successful connection</p>

</div>
</div>
<a id="gab7d6082d420719c5e210b8b387cda184" name="gab7d6082d420719c5e210b8b387cda184"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab7d6082d420719c5e210b8b387cda184">&#9670;&#160;</a></span>checkCellandSocCutoff()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void checkCellandSocCutoff </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Monitors cell voltages and state of charge for safety cutoffs. </p>
<p>This critical safety function performs multiple checks:</p><ul>
<li>Overvoltage protection: stops charging if any cell exceeds CellMaxCutOffV</li>
<li>Undervoltage protection: stops discharging if any cell falls below CellMinCutOffV <br  />
</li>
<li>Full charge detection: stops charging when all cells reach CellFullChargeV</li>
<li>State of charge limits: manages charging based on pack capacity</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Uses global variables for cell voltages and thresholds </dd>
<dd>
Updates global CHARGING flag based on safety conditions </dd></dl>
<dl class="section post"><dt>Postcondition</dt><dd>Prints detailed status messages for any triggered conditions </dd></dl>

</div>
</div>
<a id="ga1de5db1b0b55008babf30a501b39b6b7" name="ga1de5db1b0b55008babf30a501b39b6b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga1de5db1b0b55008babf30a501b39b6b7">&#9670;&#160;</a></span>checkI2C()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool checkI2C </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check I2C communication with BQ25730. </p>
<dl class="section return"><dt>Returns</dt><dd>true if device responds with valid ID, false otherwise </dd></dl>
<p>&lt; Read device ID register</p>
<p>&lt; Return true if ID is valid (not 0x0000 or 0xFFFF)</p>

</div>
</div>
<a id="gabf363a8269099400e262e0c39becc8a0" name="gabf363a8269099400e262e0c39becc8a0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gabf363a8269099400e262e0c39becc8a0">&#9670;&#160;</a></span>CheckIfINAConnected()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CheckIfINAConnected </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes and verifies INA219 current sensors. </p>
<p>Attempts to initialize three INA219 sensors at different I2C addresses. The system halts if any sensor fails to initialize, as all sensors are required for proper cell voltage monitoring.</p>
<dl class="section note"><dt>Note</dt><dd>INA219 sensors at addresses: 0x40, 0x41, 0x44 </dd>
<dd>
Address 0x45 is commented out (optional fourth sensor) </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>System halts in infinite loop if any sensor initialization fails </dd></dl>

</div>
</div>
<a id="gad56b6e6d2810d8f19d6debf12443fdfd" name="gad56b6e6d2810d8f19d6debf12443fdfd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad56b6e6d2810d8f19d6debf12443fdfd">&#9670;&#160;</a></span>clearEEPROM()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void clearEEPROM </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Clears all EEPROM data by setting all bytes to 0xFF. </p>
<p>This function erases all configuration data stored in EEPROM by writing 0xFF to every byte in the configured EEPROM range. This effectively resets the system to an unconfigured state.</p>
<dl class="section note"><dt>Note</dt><dd>System reboot is required after calling this function </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>This operation is irreversible - all stored configuration will be lost </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group___e_e_p_r_o_m___storage.html#gac2d2d7a3a28c2b8ca8d9232391d58965" title="Total EEPROM length for 9 float values.">EEPROM_TOTAL_LENGTH</a> </dd></dl>

</div>
</div>
<a id="ga68faf4969b4fd59b23916844263fa728" name="ga68faf4969b4fd59b23916844263fa728"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga68faf4969b4fd59b23916844263fa728">&#9670;&#160;</a></span>ConfigAndStartBQ()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ConfigAndStartBQ </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Configure and start BQ25730 charger with initial settings. </p>
<p>Sets charge voltage, current limits, enables ADC, and starts charging </p>
<p>&lt; Set target charging voltage</p>
<p>&lt; Set input voltage limit</p>
<p>&lt; Set charging current</p>
<p>&lt; Set input current limit</p>
<p>&lt; Set minimum system voltage</p>
<p>&lt; Enable ADC measurements</p>
<p>&lt; Enable charging operation</p>

</div>
</div>
<a id="ga5708add1ce23a932ff6c9f64cb84ae06" name="ga5708add1ce23a932ff6c9f64cb84ae06"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga5708add1ce23a932ff6c9f64cb84ae06">&#9670;&#160;</a></span>ConfigCheck()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ConfigCheck </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs final configuration check and saves settings to EEPROM. </p>
<p>This function detaches the timer interrupt, saves all configuration parameters to EEPROM, marks the system as configured, and restarts the system check timer. It acts as the final step in the configuration process.</p>
<dl class="section note"><dt>Note</dt><dd>This function is called when all configuration parameters have been received </dd>
<dd>
The timer is temporarily detached to prevent conflicts during EEPROM operations</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="#ga3a0c6d2d9f8bac7b4f689eb7844c165d" title="Checks and loads configuration from EEPROM if available.">EEPROM_Check()</a> </dd>
<dd>
<a class="el" href="#ga68faf4969b4fd59b23916844263fa728" title="Configure and start BQ25730 charger with initial settings.">ConfigAndStartBQ()</a> </dd></dl>

</div>
</div>
<a id="gae0f230a6e9357f99995951287147b6ee" name="gae0f230a6e9357f99995951287147b6ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae0f230a6e9357f99995951287147b6ee">&#9670;&#160;</a></span>disableCharging()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void disableCharging </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Disables charging by setting charge inhibit bit. </p>
<p>Prevents the battery from charging by writing to the ChargeOption0 register. This is used for safety shutdowns and normal charge termination.</p>
<dl class="section note"><dt>Note</dt><dd>Writes 0xE70F to inhibit charging while keeping other settings </dd></dl>

</div>
</div>
<a id="ga2d4bd64f668a6ea0b2f5a8424d9a1100" name="ga2d4bd64f668a6ea0b2f5a8424d9a1100"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2d4bd64f668a6ea0b2f5a8424d9a1100">&#9670;&#160;</a></span>disableVSYS()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void disableVSYS </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Disable VSYS output due to low battery condition. </p>
<p>Forces battery FET off to disconnect system load when battery is critically low </p>
<p>&lt; Print warning message</p>
<p>&lt; Read current ChargeOption0 register</p>
<p>&lt; Clear EN_OTG bit (disable OTG mode)</p>
<p>&lt; Write back modified register</p>
<p>&lt; Read current ChargeOption3 register</p>
<p>&lt; Clear BATFETOFF_HIZ bit</p>
<p>&lt; Write back modified register</p>
<p>&lt; Set BATFET_ENZ bit to force battery FET off</p>
<p>&lt; Write back modified register</p>
<p>&lt; Read back register for confirmation</p>
<p>&lt; Print confirmation message</p>
<p>&lt; Print register value in hex</p>

</div>
</div>
<a id="ga4984336d1011808120b4221bbd3c48af" name="ga4984336d1011808120b4221bbd3c48af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga4984336d1011808120b4221bbd3c48af">&#9670;&#160;</a></span>dumpAllBQRegisters()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dumpAllBQRegisters </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Dumps all BQ25730 registers for debugging. </p>
<p>Reads and displays all registers from the BQ25730 charge controller. This is useful for debugging configuration issues and monitoring chip state.</p>
<dl class="section note"><dt>Note</dt><dd>Reads registers from 0x00 to 0x3E in 2-byte increments </dd></dl>
<dl class="section post"><dt>Postcondition</dt><dd>Prints all register values in hexadecimal format to Serial </dd></dl>

</div>
</div>
<a id="ga3a0c6d2d9f8bac7b4f689eb7844c165d" name="ga3a0c6d2d9f8bac7b4f689eb7844c165d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3a0c6d2d9f8bac7b4f689eb7844c165d">&#9670;&#160;</a></span>EEPROM_Check()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EEPROM_Check </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks and loads configuration from EEPROM if available. </p>
<p>This function verifies if the EEPROM contains valid configuration data. If valid data is found, it loads all configuration parameters and marks the system as configured. If no valid data is found, the system remains in unconfigured state.</p>
<dl class="section note"><dt>Note</dt><dd>This function is called during system startup </dd>
<dd>
Automatically calls <a class="el" href="#ga68faf4969b4fd59b23916844263fa728" title="Configure and start BQ25730 charger with initial settings.">ConfigAndStartBQ()</a> and <a class="el" href="#ga47d79ee7b65523eac216088cb98bbfbb" title="Main system monitoring and control function (Timer ISR)">SystemCheck()</a> if configured</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="#gac732a8f96986a17c049865fa413935b5" title="Checks if EEPROM contains valid (non-blank) data.">isEEPROMInitialized()</a> </dd>
<dd>
<a class="el" href="#ga68faf4969b4fd59b23916844263fa728" title="Configure and start BQ25730 charger with initial settings.">ConfigAndStartBQ()</a> </dd>
<dd>
<a class="el" href="#ga47d79ee7b65523eac216088cb98bbfbb" title="Main system monitoring and control function (Timer ISR)">SystemCheck()</a> </dd></dl>

</div>
</div>
<a id="ga5eddb9004f705b0881f16a636b2d83cf" name="ga5eddb9004f705b0881f16a636b2d83cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga5eddb9004f705b0881f16a636b2d83cf">&#9670;&#160;</a></span>enableADC()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void enableADC </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Enables ADC measurements on the BQ25730. </p>
<p>Configures the ADC to continuously measure voltages and currents. This is required for monitoring battery and system parameters.</p>
<dl class="section note"><dt>Note</dt><dd>Writes 0x40FF to enable all ADC channels </dd></dl>

</div>
</div>
<a id="gab30ea562af302301b7672b24f4481c86" name="gab30ea562af302301b7672b24f4481c86"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab30ea562af302301b7672b24f4481c86">&#9670;&#160;</a></span>enableCharging()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void enableCharging </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Enables charging by configuring ChargeOption0 register. </p>
<p>Disables the watchdog timer and permanently enables charging by writing the appropriate configuration to the ChargeOption0 register.</p>
<dl class="section note"><dt>Note</dt><dd>Writes 0xE70E to disable watchdog and enable charging </dd></dl>

</div>
</div>
<a id="ga5ef907155a3498383307a0e26da4e010" name="ga5ef907155a3498383307a0e26da4e010"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga5ef907155a3498383307a0e26da4e010">&#9670;&#160;</a></span>EnableGPIOPins()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EnableGPIOPins </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Configures GPIO pins for various system functions. </p>
<p>Sets up GPIO pins for:</p><ul>
<li>Cell balancing circuits (4 pins for bypass resistors)</li>
<li>Charge status indication (CHG_OK input)</li>
<li>Status LEDs (power, charge, error, status)</li>
<li>Temperature sensors (4 thermistor inputs)</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Balancer pins: PB1, PB0, PA7, PA6 (cells 1-4) </dd>
<dd>
LED pins: PB15, PB14, PB13, PB12 (power, charge, error, status) </dd>
<dd>
Thermistor pins: PA2, PA3, PA4, PA5 (sensors 1-4) </dd></dl>

</div>
</div>
<a id="gae1455fa902ab93ac72aa2c75cc301799" name="gae1455fa902ab93ac72aa2c75cc301799"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae1455fa902ab93ac72aa2c75cc301799">&#9670;&#160;</a></span>handleSerialCharging()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void handleSerialCharging </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Processes serial commands for manual charge control. </p>
<p>Handles text commands received via Serial interface:</p><ul>
<li>"START": Manually enables charging</li>
<li>"STOP": Manually disables charging <br  />
</li>
<li>"AUTO": Toggles automatic charge-on-plugin mode</li>
<li>"RST"/"reset"/"RESET": Triggers software reset</li>
</ul>
<p>Commands are processed line-by-line and converted to uppercase. Invalid commands display help text.</p>
<dl class="section note"><dt>Note</dt><dd>Uses global serialCmdBuffer to accumulate characters </dd>
<dd>
Buffer is limited to 20 characters to prevent overflow </dd></dl>
<dl class="section post"><dt>Postcondition</dt><dd>Updates global CHARGING and CHARGE_ON_PLUGIN flags </dd>
<dd>
Provides user feedback via Serial print statements </dd></dl>

</div>
</div>
<a id="gac732a8f96986a17c049865fa413935b5" name="gac732a8f96986a17c049865fa413935b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac732a8f96986a17c049865fa413935b5">&#9670;&#160;</a></span>isEEPROMInitialized()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool isEEPROMInitialized </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>startAddr</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>length</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks if EEPROM contains valid (non-blank) data. </p>
<p>This function scans a specified range of EEPROM addresses to determine if the memory contains valid configuration data. EEPROM is considered uninitialized if all bytes are 0xFF (blank/erased state).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">startAddr</td><td>Starting address to check in EEPROM </td></tr>
    <tr><td class="paramname">length</td><td>Number of bytes to check from startAddr </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if EEPROM contains data (at least one byte != 0xFF) </dd>
<dd>
false if EEPROM is blank (all bytes == 0xFF)</dd></dl>
<dl class="section note"><dt>Note</dt><dd>0xFF is the default erased state of EEPROM </dd></dl>

</div>
</div>
<a id="gafe461d27b9c48d5921c00d521181f12f" name="gafe461d27b9c48d5921c00d521181f12f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gafe461d27b9c48d5921c00d521181f12f">&#9670;&#160;</a></span>loop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void loop </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main program loop (intentionally empty) </p>
<p>The main loop is intentionally left empty as all system functionality is handled by the timer interrupt (<a class="el" href="#ga47d79ee7b65523eac216088cb98bbfbb" title="Main system monitoring and control function (Timer ISR)">SystemCheck()</a>) and I2C event handlers. A NOP (no operation) instruction is used to prevent compiler optimization.</p>
<dl class="section note"><dt>Note</dt><dd>All system operations are interrupt-driven </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="#ga47d79ee7b65523eac216088cb98bbfbb" title="Main system monitoring and control function (Timer ISR)">SystemCheck()</a> </dd>
<dd>
<a class="el" href="#ga3e21dc6b2d0de8c60db0cf01b0625b4c" title="I2C receive event handler for command processing.">onReceive()</a> </dd>
<dd>
<a class="el" href="#gac6532b6359ec1083f0936a3a1c93bdce" title="I2C request event handler for sending response data.">onRequest()</a> </dd></dl>

</div>
</div>
<a id="ga0882365eaa2c963c6b0b2e57237c6b90" name="ga0882365eaa2c963c6b0b2e57237c6b90"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga0882365eaa2c963c6b0b2e57237c6b90">&#9670;&#160;</a></span>MaintainChargingBQ()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MaintainChargingBQ </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Maintains charging operation and I2C communication. </p>
<p>This function performs periodic maintenance tasks to ensure reliable operation:</p><ul>
<li>Checks I2C communication integrity</li>
<li>Re-initializes I2C bus if communication fails</li>
<li>Periodically updates charge voltage and current registers</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Should be called regularly during charging to prevent watchdog timeouts </dd>
<dd>
Uses global variables: lastCheck1, lastCheck2, I2CcheckInterval, registerUpdateInterval </dd></dl>

</div>
</div>
<a id="ga3e21dc6b2d0de8c60db0cf01b0625b4c" name="ga3e21dc6b2d0de8c60db0cf01b0625b4c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3e21dc6b2d0de8c60db0cf01b0625b4c">&#9670;&#160;</a></span>onReceive()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void onReceive </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>howMany</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>I2C receive event handler for command processing. </p>
<p>This function handles incoming I2C data from the master device. It processes two types of commands:</p><ul>
<li>Single byte commands (0x01-0x08): Request for sensor readings</li>
<li>Five byte commands (0x10-0x19): Configuration parameter updates</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">howMany</td><td>Number of bytes received via I2C</td></tr>
  </table>
  </dd>
</dl>
<p>Single byte commands:</p><ul>
<li>0x01: Cell 1 voltage (PackVoltage - INA_0x44_VOLTAGE)</li>
<li>0x02: Cell 2 voltage (INA_0x44_VOLTAGE - INA_0x41_VOLTAGE)</li>
<li>0x03: Cell 3 voltage (INA_0x41_VOLTAGE - INA_0x40_VOLTAGE)</li>
<li>0x04: Cell 4 voltage (INA_0x40_VOLTAGE)</li>
<li>0x05: Total pack voltage</li>
<li>0x06: Pack current</li>
<li>0x08: Real charge in mAh</li>
</ul>
<p>Five byte commands (command + 4-byte float):</p><ul>
<li>0x10: Charge voltage value</li>
<li>0x11: System minimum voltage</li>
<li>0x13: Input voltage value</li>
<li>0x14: Charge current value</li>
<li>0x15: Input current limit</li>
<li>0x16: Cell maximum cutoff voltage</li>
<li>0x17: Cell minimum cutoff voltage</li>
<li>0x18: Pack stock capacity (triggers <a class="el" href="#ga5708add1ce23a932ff6c9f64cb84ae06" title="Performs final configuration check and saves settings to EEPROM.">ConfigCheck()</a>)</li>
<li>0x19: Configuration status from master</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Timer interrupt is temporarily detached during parameter updates to prevent conflicts </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>Unknown commands will set responseData to -1.0 </dd></dl>

</div>
</div>
<a id="gac6532b6359ec1083f0936a3a1c93bdce" name="gac6532b6359ec1083f0936a3a1c93bdce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac6532b6359ec1083f0936a3a1c93bdce">&#9670;&#160;</a></span>onRequest()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void onRequest </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>I2C request event handler for sending response data. </p>
<p>This function is called when the master device requests data from this slave. It sends the current responseData value (set by onReceive) and resets it to 0.0.</p>
<dl class="section note"><dt>Note</dt><dd>responseData is automatically reset to 0.0 after each transmission </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="#ga3e21dc6b2d0de8c60db0cf01b0625b4c" title="I2C receive event handler for command processing.">onReceive()</a> </dd></dl>

</div>
</div>
<a id="gaab5e0e511f1bb8041569b20b1489527b" name="gaab5e0e511f1bb8041569b20b1489527b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaab5e0e511f1bb8041569b20b1489527b">&#9670;&#160;</a></span>readBatteryCurrent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void readBatteryCurrent </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads and displays battery current measurements. </p>
<p>Reads the ADCIBAT register to get both charge and discharge current measurements. The register contains separate fields for charge and discharge currents with different LSB values.</p>
<dl class="section note"><dt>Note</dt><dd>Discharge current: bits[0:6] at 512 mA/LSB </dd>
<dd>
Charge current: bits[8:14] at 128 mA/LSB </dd></dl>
<dl class="section post"><dt>Postcondition</dt><dd>Prints current measurements to Serial </dd></dl>

</div>
</div>
<a id="ga2c4dd77d242508e96fb3513e753976f7" name="ga2c4dd77d242508e96fb3513e753976f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2c4dd77d242508e96fb3513e753976f7">&#9670;&#160;</a></span>readBQ25730()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t readBQ25730 </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>regAddr</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read 16-bit data from BQ25730 register. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">regAddr</td><td>Register address to read from </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>16-bit data read from register </dd></dl>
<p>&lt; Start I2C transmission to BQ25730</p>
<p>&lt; Send register address</p>
<p>&lt; End transmission with repeated start</p>
<p>&lt; Request 2 bytes from BQ25730</p>
<p>&lt; Initialize data variable</p>
<p>&lt; Check if 2 bytes are available</p>
<p>&lt; Read low byte</p>
<p>&lt; Read high byte and combine</p>
<p>&lt; Return combined 16-bit data</p>

</div>
</div>
<a id="gacb449db001d5ad9a7758556e5ca2160a" name="gacb449db001d5ad9a7758556e5ca2160a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gacb449db001d5ad9a7758556e5ca2160a">&#9670;&#160;</a></span>set_VSYS_MIN()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void set_VSYS_MIN </td>
          <td>(</td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>voltage_V</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the minimum system voltage (VSYS_MIN) for the BQ25730. </p>
<p>This function configures the minimum voltage that the system rail will be regulated to. The system will prioritize maintaining this voltage over charging the battery.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">voltage_V</td><td>Minimum system voltage in volts (valid range: 1.0V - 23.0V) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Voltage is encoded with 0.1V resolution in the upper 8 bits </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>Function returns early if voltage is out of range </dd></dl>

</div>
</div>
<a id="ga97c42fd6e90822b907550eb226598161" name="ga97c42fd6e90822b907550eb226598161"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga97c42fd6e90822b907550eb226598161">&#9670;&#160;</a></span>setChargeCurrent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setChargeCurrent </td>
          <td>(</td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>current_A</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set charging current limit. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_A</td><td>Charging current in amps (0 - 16.256A range) </td></tr>
  </table>
  </dd>
</dl>
<p>&lt; Check if current is within valid range</p>
<p>&lt; Print error message</p>
<p>&lt; Exit function if out of range</p>
<p>&lt; Convert current to step count (128mA per step)</p>
<p>&lt; Encode for register format (shifted left 6 bits)</p>
<p>&lt; Print encoded value being written</p>
<p>&lt; Print current value</p>
<p>&lt; Write encoded value to charge current register</p>
<p>&lt; Print blank line for formatting</p>

</div>
</div>
<a id="ga01cd5968ed55b80dc4b92b0a52e0e466" name="ga01cd5968ed55b80dc4b92b0a52e0e466"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga01cd5968ed55b80dc4b92b0a52e0e466">&#9670;&#160;</a></span>setChargeVoltage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setChargeVoltage </td>
          <td>(</td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>voltage_V</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set charging voltage target. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">voltage_V</td><td>Target charging voltage in volts (1.024V - 23.000V range) </td></tr>
  </table>
  </dd>
</dl>
<p>&lt; Check if voltage is within valid range</p>
<p>&lt; Print error message</p>
<p>&lt; Exit function if out of range</p>
<p>&lt; Convert voltage to step count (8mV per step)</p>
<p>&lt; Encode for register format (13 bits shifted left 3)</p>
<p>&lt; Print encoded value being written</p>
<p>&lt; Print voltage value</p>
<p>&lt; Write encoded value to charge voltage register</p>

</div>
</div>
<a id="ga3d8eff3631e2364d8be2890e9baabe63" name="ga3d8eff3631e2364d8be2890e9baabe63"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3d8eff3631e2364d8be2890e9baabe63">&#9670;&#160;</a></span>setInputCurrentLimit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setInputCurrentLimit </td>
          <td>(</td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>current_mA</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set input current limit. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_mA</td><td>Input current limit in milliamps (50mA - 6350mA range) </td></tr>
  </table>
  </dd>
</dl>
<p>&lt; Clamp minimum to 50mA</p>
<p>&lt; Clamp maximum to 6350mA</p>
<p>&lt; Convert to code (50mA per step)</p>
<p>&lt; Encode for register format (shifted left 8 bits)</p>
<p>&lt; Print encoded value being written</p>
<p>&lt; Print current value</p>
<p>&lt; Write encoded value to input current register</p>

</div>
</div>
<a id="ga418209c95fe881aa56d9e82ac1b4ad63" name="ga418209c95fe881aa56d9e82ac1b4ad63"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga418209c95fe881aa56d9e82ac1b4ad63">&#9670;&#160;</a></span>setInputVoltage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setInputVoltage </td>
          <td>(</td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>voltage_V</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the input voltage limit for the BQ25730 charge controller. </p>
<p>This function configures the minimum input voltage threshold. The charger will not operate if the input voltage falls below this setting.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">voltage_V</td><td>Input voltage in volts (valid range: 3.2V - 23.0V) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>The voltage is encoded with 64mV resolution and written to the InputVoltage register </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>Function returns early if voltage is out of range </dd></dl>

</div>
</div>
<a id="ga4fc01d736fe50cf5b977f755b675f11d" name="ga4fc01d736fe50cf5b977f755b675f11d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga4fc01d736fe50cf5b977f755b675f11d">&#9670;&#160;</a></span>setup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setup </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>System initialization and setup function. </p>
<p>This function performs all necessary system initialization including:</p><ul>
<li>Serial communication setup</li>
<li>I2C bus initialization</li>
<li>EEPROM configuration check and loading</li>
<li>I2C slave setup with event handlers</li>
<li>Hardware component initialization (LTC2943, BQ, INA sensors)</li>
<li>GPIO pin configuration</li>
<li>Timer interrupt setup for periodic system checks</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>5-second delay at start allows for stable power-up </dd>
<dd>
System check runs every 5 seconds (5,000,000 microseconds) </dd>
<dd>
EEPROM is cleared at startup (<a class="el" href="#gad56b6e6d2810d8f19d6debf12443fdfd" title="Clears all EEPROM data by setting all bytes to 0xFF.">clearEEPROM()</a> call)</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="#ga3a0c6d2d9f8bac7b4f689eb7844c165d" title="Checks and loads configuration from EEPROM if available.">EEPROM_Check()</a> </dd>
<dd>
<a class="el" href="#ga3e21dc6b2d0de8c60db0cf01b0625b4c" title="I2C receive event handler for command processing.">onReceive()</a> </dd>
<dd>
<a class="el" href="#gac6532b6359ec1083f0936a3a1c93bdce" title="I2C request event handler for sending response data.">onRequest()</a> </dd>
<dd>
<a class="el" href="#ga47d79ee7b65523eac216088cb98bbfbb" title="Main system monitoring and control function (Timer ISR)">SystemCheck()</a> </dd></dl>

</div>
</div>
<a id="ga47d79ee7b65523eac216088cb98bbfbb" name="ga47d79ee7b65523eac216088cb98bbfbb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga47d79ee7b65523eac216088cb98bbfbb">&#9670;&#160;</a></span>SystemCheck()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SystemCheck </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main system monitoring and control function (Timer ISR) </p>
<p>This function serves as the main system loop, called every 5 seconds by the timer interrupt. It performs comprehensive system monitoring and control:</p>
<p>When CONFIGURED == true:</p><ul>
<li>Handles serial charging input commands</li>
<li>Reports charging status</li>
<li>Executes charge and balance control algorithms</li>
<li>Monitors battery temperature</li>
<li>Restarts the timer for next cycle</li>
</ul>
<p>When CONFIGURED == false:</p><ul>
<li>Displays "AWAITING CONFIGURATION" message</li>
<li>Stops timer to prevent unnecessary cycles</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Timer is temporarily detached at start to prevent re-entry </dd>
<dd>
Function only executes full monitoring when system is configured </dd>
<dd>
Serial output provides detailed system status information</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="#gae1455fa902ab93ac72aa2c75cc301799" title="Processes serial commands for manual charge control.">handleSerialCharging()</a> </dd>
<dd>
<a class="el" href="#gac7f04b5f3622adc4c899012ea1d8e6e3" title="Main charge and cell balancing control function.">ChargeAndBalanceControl()</a> </dd>
<dd>
<a class="el" href="#gad511a9c47838109c758c7c4284d2b242" title="Monitors thermistor temperatures for overheat protection.">TempCheck()</a> </dd></dl>

</div>
</div>
<a id="gad511a9c47838109c758c7c4284d2b242" name="gad511a9c47838109c758c7c4284d2b242"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad511a9c47838109c758c7c4284d2b242">&#9670;&#160;</a></span>TempCheck()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TempCheck </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Monitors thermistor temperatures for overheat protection. </p>
<p>Reads analog values from four thermistor inputs and checks against the THERMISTER_THRESHOLD. If any sensor exceeds the threshold, the system immediately stops charging and disables VSYS for safety.</p>
<dl class="section note"><dt>Note</dt><dd>Thermistors connected to pins PA2, PA3, PA4, PA5 </dd>
<dd>
Threshold comparison uses raw ADC values (0-4095 range) </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>System enters error state if overheating is detected </dd></dl>
<dl class="section post"><dt>Postcondition</dt><dd>Sets global ERRORFLG and OVERHEAT flags if threshold exceeded </dd>
<dd>
Disables charging and VSYS output for safety </dd></dl>

</div>
</div>
<a id="gaf6496b205c191db45c1b03fdc69b37b8" name="gaf6496b205c191db45c1b03fdc69b37b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaf6496b205c191db45c1b03fdc69b37b8">&#9670;&#160;</a></span>writeBQ25730()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void writeBQ25730 </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>regAddr</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>data</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write 16-bit data to BQ25730 register. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">regAddr</td><td>Register address to write to </td></tr>
    <tr><td class="paramname">data</td><td>16-bit data to write (LSB first, then MSB) </td></tr>
  </table>
  </dd>
</dl>
<p>&lt; Start I2C transmission to BQ25730</p>
<p>&lt; Send register address</p>
<p>&lt; Send low byte</p>
<p>&lt; Send high byte</p>
<p>&lt; End I2C transmission</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
